# Семафор

**Семафор** — это механизм синхронизации, используемый в многопоточном программировании для управления доступом к общим
ресурсам. Семафор содержит счетчик, который ограничивает количество потоков, имеющих доступ к ресурсу одновременно.

- **Бинарный семафор**: Семафор с максимальным значением счетчика 1, действует как мьютекс, позволяя только одному
  потоку использовать ресурс в определенный момент времени.
- **Счетный (или подсчетный) семафор**: Семафор с счетчиком, превышающим 1, позволяет ограниченному числу потоков
  одновременно использовать ресурс.

## Зачем нужен семафор в многопоточном программировании?

- **Управление доступом к ограниченным ресурсам:** Когда ресурс может быть использован одновременно ограниченным числом
  потоков (например, пул соединений к базе данных).
- **Контроль параллелизма:** Ограничивает количество потоков, выполняющих определенный участок кода, что может быть
  полезно для предотвращения перегрузки системы.
- **Синхронизация потоков:** Используется для координации действий между потоками, обеспечивая выполнение операций в
  определенном порядке.

## Семафоры в Java

В Java семафоры реализованы в классе ```Semaphore```, который находится в пакете ```java.util.concurrent```.
Класс ```Semaphore``` предоставляет методы для управления доступом к ресурсам и синхронизации потоков.

## Основные методы класса ```Semaphore```

### Конструкторы

```
public Semaphore(int permits)
public Semaphore(int permits, boolean fair)
```

- ```permits``` — начальное число разрешений (количество доступов к ресурсу).
- ```fair``` — параметр справедливости. Если true, то потоки будут получать разрешения в порядке запроса (FIFO).

### Методы

- ```acquire()```: Запрашивает разрешение. Если разрешения нет, поток блокируется до его получения.

```
public void acquire() throws InterruptedException
```

---

- ```release()```: Освобождает разрешение, увеличивая счетчик семафора.

```
public void release()
```

---

- ```tryAcquire()```: Пытается получить разрешение без ожидания.

```
public boolean tryAcquire()
```

---

- ```availablePermits()```: Возвращает текущее количество доступных разрешений.

```
public int availablePermits()
```

## Пример использование семафора для ограничения доступа к ресурсу

Предположим есть ресурс к которому не более 3 потоков могут обращаться одновременно.

```java
public class ResourceAccess {
    private static final int MAX_CONCURRENT_THREADS = 3;
    private final Semaphore semaphore = new Semaphore(MAX_CONCURRENT_THREADS);

    public void useResource() {
        try {
            semaphore.acquire();
            // Критическая секция: доступ к ресурсу
            System.out.println(Thread.currentThread().getName() + " использует ресурс");
            Thread.sleep(2000); // Симуляция работы с ресурсом
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        } finally {
            semaphore.release();
            System.out.println(Thread.currentThread().getName() + " освободил ресурс");
        }
    }

    public static void main(String[] args) {
        ResourceAccess example = new ResourceAccess();

        for (int i = 0; i < 10; i++)
            new Thread(example::useResource, "Поток " + i).start();
    }
}
```

- **Семафор ```semaphore``` с 3 разрешениями**: Только 3 потока могут одновременно выполнять метод ```useResource()```.
- **Метод ```acquire()```**: Поток запрашивает разрешение перед доступом к ресурсу.
- **Метод ```release()```**: После использования ресурса поток освобождает разрешение.

## Особенности и важные моменты при использовании семафоров

- **Справедливость (Fairness):**
    - При создании семафора можно указать параметр справедливости.
    - ```new Semaphore(permits, true)```: Потоки будут получать разрешения в порядке их запроса (```FIFO```).
    - **Без справедливости (false)**: Потоки могут получить разрешение вне очереди, что может привести к голоданию
      некоторых потоков.
- **Переполнение и отрицательные разрешения:**
    - Количество разрешений семафора может стать отрицательным, если использовать методы ```release()``` без
      соответствующих ```acquire()```.
    - Необходимо следить за корректностью использования методов ```acquire()``` и ```release()```.
- **Неявная очередь ожидания:** Потоки, ожидающие разрешения, помещаются в очередь. При освобождении разрешения один из
  ожидающих потоков будет разбужен.
- **Прерывания:** Методы acquire() и release() могут бросать ```InterruptedException```. Следует правильно обрабатывать
  это исключение.

## Сравнение семафора и мьютекса

### Мьютекс (Mutex):

- Ограничивает доступ к ресурсу одним потоком.
- Обычно используется для защиты критических секций кода.

### Семафор:

- Может ограничивать доступ нескольким потокам одновременно.
- Более гибкий механизм синхронизации по сравнению с мьютексом.

## Когда использовать семафор

- **Ограничение доступа к ресурсам:** Когда ресурс может быть использован одновременно ограниченным числом потоков.
- **Синхронизация операций:** Когда требуется организовать порядок выполнения операций между потоками.
- **Ограничение параллелизма:** Для контроля нагрузки на систему, ограничивая количество одновременно выполняемых задач.

# Заключение

Семафор — мощный инструмент для управления доступом к ресурсам и синхронизации потоков в многопоточном программировании.
В Java класс Semaphore предоставляет гибкий и удобный интерфейс для реализации семафоров, позволяя разработчикам
эффективно контролировать параллельность и обеспечивать корректность работы многопоточных приложений.



